{% extends 'base.html' %}
{% block tittle %}
Запись
{% endblock %}
{% load static %}
{% block content %}
{% include 'records/includes/switcher.html' %}
<h1 style="margin-left: 42%">Запись</h1>
  <div class="row justify-content-center lol_width">
    <div class="col-md-8 p-5">
      <div class="card">
        <div class="card-body" style="margin-left: 25%">
          <h3 style="margin-left: 17%">
            {{date_str}}
          </h3>
          {% if not error and not old_date and not many_rec %}
          <h6 style="margin-left: 6%">
          Запись доступна с {{services.low_time}} до {{services.high_time}}
          </h6>
          {% endif %}
          {% if old_date or many_rec%}
          <h3>
            {{old_date}}
            {{many_rec}}
          </h3>
          {% endif %}
          {% if error %}
          <h2>
            {{error}}
          </h2>
          <a href="{% url 'records:records_start' project date %}" class="btn btn-primary" style="margin-left: 14%">
            Начать заново
          </a>
          {% endif %}
          {% if form.errors %}
            {% for field in form %}
              {% for error in field.errors %}            
                <div class="alert alert-danger">
                  {{ error|escape }}
                </div>
              {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
              <div class="alert alert-danger">
                {{ error|escape }}
              </div>
            {% endfor %}
            {% endif %}
            <form method="post" style="margin: 20px 0 0 0 !important;">
              {% csrf_token %}
              {{ form.as_p }}
              <div style="margin-left: 15%">
                {% if error or old_date or many_rec %}
                <a href="{% url 'records:index_records' project %}" class="btn btn-primary">
                  На главную
                </a>
                {% endif %}
                {% if not error and not old_date and not many_rec %}
                <button type="submit" class="btn btn-primary">
                  Записаться
                </button>
                {% endif %}
              </div>
            </form>
          </div>
          {% if not error and not old_date and not many_rec %}
          <div id="slider-range"></div>
          {{color_table|safe}}
          {% endif %}
        <div class="card-header">
          Записи
        </div>
        <div style='height: 230px'>
          {{ride_rec|safe}}
          {% if ride_rec_empty %}
          <div style='text-align: center; position: relative; top: 40%;'>
            <h1>{{ride_rec_empty}}</h1>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{{calendar}}
<script src="https://snipp.ru/cdn/jquery/2.1.1/jquery.min.js"></script>
<script src="https://snipp.ru/cdn/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://snipp.ru/cdn/jQuery-Timepicker-Addon/dist/jquery-ui-timepicker-addon.min.js"></script>
<script>
  function time_hour(val){
    if (val < 120){
      return '0' + (val - val % 12) / 12;
    }
    else{
      return (val - val % 12) / 12;
    }
}
  function time_minute(val){
    if ((val % 12) == (0) || (val % 12) == (1)) {
      return '0' + (val % 12) * 5;
    }
    else{
      return (val % 12) * 5;
    }
}
  $(document).ready(function(){
    $( "#slider-range" ).slider({
        range: true,
        min: 0,
        max: 288,
        values: [ 120, 216 ],
        slide: function( event, ui ) {
          $("#id_start_time").val(time_hour(ui.values[0])+":"+time_minute(ui.values[0]));
          $("#id_end_time").val(time_hour(ui.values[1])+":"+time_minute(ui.values[1]));
        }
      });
});
$.timepicker.regional['ru'] = {
	timeOnlyTitle: 'Выберите время',
	timeText: 'Время',
	hourText: 'Часы',
	minuteText: 'Минуты',
	secondText: 'Секунды',
	millisecText: 'Миллисекунды',
	timezoneText: 'Часовой пояс',
	currentText: 'Сейчас',
	closeText: 'Закрыть',
	timeFormat: 'HH:mm',
	amNames: ['AM', 'A'],
	pmNames: ['PM', 'P'],
	isRTL: false
};
$.timepicker.setDefaults($.timepicker.regional['ru']);

$(function(){
	$("#id_start_time").timepicker({
    "stepMinute" : 5
  });
  $("#id_end_time").timepicker({
    "stepMinute" : 5
  });
});
</script>
{% endblock %} 